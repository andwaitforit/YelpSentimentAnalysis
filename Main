# -*- coding: utf-8 -*-
"""
Created on Thu Feb 21 11:23:01 2019

@author: ahorgan
"""

import json
#import pprint as p
import csv
import nltk
from nltk.corpus import stopwords
from nltk.stem import WordNetLemmatizer

def main():
    try:
        with open("yelp_academic_dataset_review_small.json", 'r') as file:
            jsonData = json.load(file)
            
            #p.pprint(jsonData[0:12])
            
            lemmaDict = {}
            
            for cell in jsonData:
                print(cell)
                text = cell['text']
                stars = cell['stars']    
                    
                
                words = [words for words in nltk.pos_tag(nltk.word_tokenize(text)) if not words in set(stopwords.words('english'))]
                
                lmtzr = WordNetLemmatizer()
                
                
                #ToDo pass POS into lemmatize function
                lemmas = [lmtzr.lemmatize(word[0]) for word in words]

                #lemmas = [lemmas for lemmas in lmtzr.lemmatize(words, pos2pos(pos[0])).lower() for w,pos in nltk.pos_tag(words)]
                print(lemmas)
                for  lemma in lemmas:
                    if lemma in lemmaDict:
                        lemmaDict[lemma] = (lemmaDict[lemma] + stars) / 2
                    else:
                        lemmaDict[lemma] =  stars
                
                #print(lemmaDict)
            
            
            #print(lemmas)
            #print(stars)
            #print(lemmaDict)
            
            
            with open("sentimentAnalysis.csv", "w+") as csvFile:
                newLine = csv.writer(csvFile, delimiter=',')
                #ordered = dict(sorted(lemmaDict.items, key=lambda x: x[0], reverse=True))
                for key, value in lemmaDict.items():
                    newLine.writerow([key, value])
                    
                
                
                
    except Exception as e:
        print(e)
    
    
    
    
    
    
    
    
    
 
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
main()
